========================
Exposure Creation Wizard
========================

In an effort to streamline the exposure creation process, a wizard that
unifies the disparate forms (documentation, file type, annotations, 
rollover) into a unified form that can serve as the base form for users
to interact with.  This is based on the rollover interface and data
structure used in the rollover interface.  There are a few components,
which includes an annotation object on the exposure object containing a
work-in-progress exposure structure, the json export version of this 
item to allow more dynamic user experience, along with the javascript
interactive controls that interface with the underlying form.  The
structure would also need to be reused later if necessary, allowing the
user to regenerate the form or load a new exposure structure from the
objects created through other means.

To demonstrate, we initialize the set of imports.
::

    >>> import zope.interface
    >>> import zope.component
    >>> from Products.CMFCore.utils import getToolByName
    >>> from pmr2.testing.base import TestRequest
    >>> from pmr2.app.interfaces import *
    >>> from pmr2.app.workspace.content import *
    >>> from pmr2.app.workspace.interfaces import *
    >>> from pmr2.app.exposure.content import *
    >>> from pmr2.app.exposure.interfaces import *

    >>> from pmr2.app.exposure.browser import wizard
    >>> from pmr2.app.exposure.browser import workspace

We acquire an exposure object that's already been created.
::

    >>> context = self.portal.exposure['1']
    >>> context
    <Exposure at /plone/exposure/1>

Then adapt that into an exposure wizard, which provides some helper
methods and the place to store a work-in-progress exposure structure.
::

    >>> ewiz = zope.component.getAdapter(context, IExposureWizard)
    >>> IExposureWizard.providedBy(ewiz)
    True

Render the wizard:
::

    >>> request = TestRequest()
    >>> context = self.portal.exposure['1']
    >>> form = wizard.ExposureWizardForm(context, request)
    >>> result = form()

That form should be fairly unpopulated. 

    >>> wkspc = self.portal.workspace.test
    >>> request = TestRequest()
    >>> form = workspace.CreateExposureForm(wkspc, request)
    >>> form.traverse_subpath = ['1']
    >>> # print form()

Alternatively, we can use the create exposure form to create our initial
exposure.
::

    >>> wkspc = self.portal.workspace.test
    >>> request = TestRequest(
    ...     form={
    ...         'file.widgets.filetype': 'Test Type',
    ...         'file.widgets.filename': 'file2',
    ...         'view.widgets.docview_generator': 'safe_html',
    ...         'view.widgets.docview_gensource': 'file2',
    ...         'form.buttons.add': 1,
    ...     })
    >>> form = workspace.CreateExposureForm(wkspc, request)
    >>> commit_id = '1'
    >>> form.traverse_subpath = [commit_id]
    >>> result = form()
    >>> context = form.ctxobj

We can render the form again using this new exposure, but we will use
the browser.

Due to the way ploneform-macros is current set up, it is not possible to
override the default testing one.  Until we customize the entire testing
stack, to see the subgroups in action we have to use the full browser 
suite to test the rendering.  First we instantiate and then log in.
::

    >>> from Testing.testbrowser import Browser
    >>> from Products.PloneTestCase.setup import default_user, default_password
    >>> b = Browser()
    >>> portal_url = self.portal.absolute_url()
    >>> b.open(portal_url + '/login')
    >>> b.getControl(name='__ac_name').value = default_user
    >>> b.getControl(name='__ac_password').value = default_password
    >>> b.getControl(name='submit').click()

Next open the form.
::

    >>> target = context.absolute_url() + '/@@wizard'
    >>> b.open(target)

Find that the update button for that subgroup is in place.
::

    >>> b.getControl(name='view.buttons.update')
    <SubmitControl name='view.buttons.update' type='submit'>

Validate the values are correctly populated.
::

    >>> b.getControl(name='view.widgets.docview_generator:list').value
    ['safe_html']
    >>> b.getControl(name='view.widgets.docview_gensource:list').value
    ['file2']
