======================
PMR2 Root Object Forms
======================

The Root object is now deprecated.

Before we get started, we need to import the required classes and set up
the test environment.
::

    >>> from pmr2.app.content.root import PMR2
    >>> from pmr2.app.tests.base import TestRequest
    >>> from plone.z3cform.tests import setup_defaults
    >>> setup_defaults()
    >>> request = TestRequest()
    >>> self.folder['test'] = PMR2('test')

Now we try the edit form.  First we try to render it.
::

    >>> from pmr2.app.browser.root import PMR2EditForm
    >>> self.folder.test
    <PMR2 at ...>
    >>> self.folder.test.repo_root
    >>> request = TestRequest()
    >>> edit = PMR2EditForm(self.folder.test, request)
    >>> html = edit()
    >>> 'repo_root' in html
    True

We now try to define the physical root, using an invalid path.  It
should fail.
::

    >>> request = TestRequest(
    ...     form={
    ...         'form.widgets.repo_root': u'not a path',
    ...         'form.buttons.apply': 1,
    ...     })
    >>> edit = PMR2EditForm(self.folder.test, request)
    >>> html = edit()
    >>> from pmr2.app.interfaces import InvalidPathError
    >>> InvalidPathError.__doc__ in html
    True

Now a real path should work.
::

    >>> tmproot = self.tmpdir
    >>> request = TestRequest(
    ...     form={
    ...         'form.widgets.repo_root': tmproot,
    ...         'form.buttons.apply': 1,
    ...     })

    >>> edit = PMR2EditForm(self.folder.test, request)
    >>> html = edit.update()

The repository root should now be set.
::

    >>> self.folder.test.repo_root == tmproot
    True
